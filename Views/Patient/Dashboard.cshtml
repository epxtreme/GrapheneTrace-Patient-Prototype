@model GrapheneTrace.Models.DashboardViewModel

@{
    ViewBag.Title = "Patient Dashboard";
}

<!-- Page layout: sidebar + main content -->
<div style="display: flex; min-height: calc(100vh - 80px);">

    <!-- LEFT SIDEBAR -->
    <div style="width: 230px; background-color: #f2f2f2; padding: 15px; border-right: 1px solid #ddd;">
        <div style="font-weight: bold; margin-bottom: 20px;">
            GrapheneTrace Patient Page
        </div>

        <!-- Search -->
        <input type="text"
               placeholder="Search"
               style="width: 100%; padding: 6px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 3px;" />

        <!-- Dashboard (selected) -->
        <button style="width: 100%; padding: 8px; margin-bottom: 8px;
                       background-color: #dcdcdc; border: 1px solid #ccc;
                       text-align: left;">
            Dashboard (selected)
        </button>

        <!-- Other sidebar items (placeholders) -->
        <button style="width: 100%; padding: 8px; margin-bottom: 8px;
                       background-color: #ffffff; border: 1px solid #ccc;
                       text-align: left;">
            Reports
        </button>

        <button style="width: 100%; padding: 8px; margin-bottom: 8px;
                       background-color: #ffffff; border: 1px solid #ccc;
                       text-align: left;">
            Analytics
        </button>

        <button style="width: 100%; padding: 8px; margin-bottom: 8px;
                       background-color: #ffffff; border: 1px solid #ccc;
                       text-align: left;">
            Inbox
        </button>

        <button style="width: 100%; padding: 8px; margin-bottom: 8px;
                       background-color: #ffffff; border: 1px solid #ccc;
                       text-align: left;">
            Media
        </button>

        <button style="width: 100%; padding: 8px; margin-bottom: 8px;
                       background-color: #ffffff; border: 1px solid #ccc;
                       text-align: left;">
            Calendar
        </button>

        <!-- LINK TO COMMENTS PAGE -->
        <a asp-controller="Patient" asp-action="Comments"
           style="display:block; width:100%; padding:8px; margin-bottom:8px;
                  background-color:#ffffff; border:1px solid #ccc;
                  text-align:left; text-decoration:none; color:black;">
            Comments
        </a>

        <button style="width: 100%; padding: 8px; margin-bottom: 8px;
                       background-color: #ffffff; border: 1px solid #ccc;
                       text-align: left;">
            Settings
        </button>
    </div>

    <!-- MAIN DASHBOARD CONTENT -->
    <div style="flex: 1; padding: 20px;">

        <!-- NAME CHANGED TO EPHRAIM -->
        <h2>Welcome, Ephraim</h2>

        <!-- Alert banner -->
        <div style="background-color: #ffe6e6; padding: 10px; margin: 15px 0;">
            <strong>Alert:</strong> High pressure detected at 14:03. Please adjust your position.
        </div>

        <!-- Metrics row -->
        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
            <div style="border: 1px solid #ccc; padding: 10px; flex: 1;">
                <strong>Peak Pressure Index (PPI)</strong><br />
                @Model.PeakPressureIndex
            </div>
            <div style="border: 1px solid #ccc; padding: 10px; flex: 1;">
                <strong>Contact Area %</strong><br />
                @Model.ContactAreaPercent %
            </div>
            <div style="border: 1px solid #ccc; padding: 10px; flex: 1;">
                <strong>Average Pressure</strong><br />
                @Model.AveragePressure
            </div>
        </div>

        <!-- Heat map + graph row -->
        <div style="display: flex; gap: 15px; margin-bottom: 20px;">

            <!-- HEAT MAP -->
            <div style="flex: 1; border: 1px solid #ccc; padding: 10px; height: 260px; position: relative;">
                <strong>Heat Map (32 x 32)</strong>

                <!-- Fake thermal image using gradients (for dummy data) -->
                <div style="
                        margin-top: 8px;
                        width: 100%;
                        height: 200px;
                        border-radius: 12px;
                        overflow: hidden;
                        background-color: #001f4d;
                        background-image:
                            radial-gradient(circle at 20% 20%, #ffff66 0, #ffcc33 20%, transparent 55%),
                            radial-gradient(circle at 75% 25%, #ffdd88 0, #ff6600 25%, transparent 60%),
                            radial-gradient(circle at 30% 80%, #99ffcc 0, #00ccff 30%, transparent 60%),
                            radial-gradient(circle at 80% 75%, #ffe680 0, #ff3300 25%, transparent 55%),
                            radial-gradient(circle at 50% 50%, #6699ff 0, #001a66 60%);
                        background-size: cover;
                        position: relative;
                    ">
                    <!-- LIVE label -->
                    <span style="
                            position: absolute;
                            top: 6px;
                            right: 8px;
                            font-size: 10px;
                            color: #ffffff;
                            letter-spacing: 1px;">
                        LIVE
                    </span>
                </div>
            </div>

            <!-- PRESSURE TREND OVER TIME -->
            <div style="flex: 1; border: 1px solid #ccc; padding: 10px; height: 260px;">
                <strong>Pressure Trend Over Time</strong>

                <!-- SVG area + line graph -->
                <div style="margin-top: 8px; width: 100%; height: 200px;">
                    <svg viewBox="0 0 100 60" preserveAspectRatio="none"
                         style="width: 100%; height: 100%; border-radius: 6px;
                                background-color: #f8fafc; border: 1px solid #e2e8f0;">

                        <!-- shaded background band -->
                        <rect x="0" y="20" width="100" height="25" fill="#e5edf8" />

                        <!-- grid lines -->
                        <line x1="0" y1="50" x2="100" y2="50" stroke="#d0d7e2" stroke-width="0.5" />
                        <line x1="0" y1="35" x2="100" y2="35" stroke="#d0d7e2" stroke-width="0.5" />
                        <line x1="0" y1="20" x2="100" y2="20" stroke="#d0d7e2" stroke-width="0.5" />
                        <line x1="0" y1="5"  x2="100" y2="5"  stroke="#d0d7e2" stroke-width="0.5" />

                        <!-- area under the line -->
                        <polygon points="
                            0,40
                            10,42
                            20,38
                            30,34
                            40,30
                            50,28
                            60,26
                            70,29
                            80,33
                            90,31
                            100,29
                            100,60
                            0,60
                        "
                        fill="#c4ddff" opacity="0.85" />

                        <!-- main blue line -->
                        <polyline
                            fill="none"
                            stroke="#2563eb"
                            stroke-width="1.8"
                            points="0,40 10,42 20,38 30,34 40,30 50,28 60,26 70,29 80,33 90,31 100,29" />

                        <!-- markers -->
                        <circle cx="0"   cy="40" r="1.4" fill="#2563eb" />
                        <circle cx="20"  cy="38" r="1.4" fill="#2563eb" />
                        <circle cx="40"  cy="30" r="1.4" fill="#2563eb" />
                        <circle cx="60"  cy="26" r="1.4" fill="#2563eb" />
                        <circle cx="80"  cy="33" r="1.4" fill="#2563eb" />
                        <circle cx="100" cy="29" r="1.4" fill="#2563eb" />
                    </svg>
                </div>

                <div style="font-size: 11px; color: #6b7280; margin-top: 4px;">
                    Example peak pressure over the last few hours (dummy data for prototype).
                </div>
            </div>
        </div>

        <!-- Time filters -->
        <div style="margin-bottom: 20px;">
            <strong>Filter:</strong>
            <button type="button">1h</button>
            <button type="button">6h</button>
            <button type="button">24h</button>
        </div>

        <!-- Add comment form -->
        <form method="post" asp-action="Dashboard"
              style="border: 1px solid #ccc; padding: 10px; margin-bottom: 15px;">
            <strong>Add Comment</strong><br />
            <textarea name="commentText" rows="3" style="width: 100%;"></textarea><br />
            <button type="submit" style="margin-top: 10px;">Save Comment</button>
        </form>

        <!-- Previous comments list -->
        @if (Model.Comments != null && Model.Comments.Count > 0)
        {
            <div style="border: 1px solid #ccc; padding: 10px;">
                <strong>Previous Comments</strong>
                <ul>
                    @foreach (var c in Model.Comments)
                    {
                        <li>
                            <em>@c.CreatedAt.ToString("g")</em> - @c.Text
                        </li>
                    }
                </ul>
            </div>
        }

    </div>
</div>
